# AI-regler for brÃ¸ytesystem
language: norsk  # All kommunikasjon skal vÃ¦re pÃ¥ norsk
style: profesjonell  # Profesjonell men konverserende tone
timezone: Europe/Oslo  # Tidssone for all datohÃ¥ndtering

# =============================================================================
# KRITISK OPPDATERING 12. AUGUST 2025 06:15 - EMPIRISK VALIDERING FULLFÃ˜RT
# =============================================================================

âœ… ALLE TEKNISKE PROBLEMER LÃ˜ST OG EMPIRISK VALIDERT:
1. NedbÃ¸rtype-klassifisering basert pÃ¥ 149 analyserte episoder
2. VindblÃ¥st snÃ¸-deteksjon med korrekte terskler (median: 12.2 m/s)
3. App-logikk 100% samsvar med empiriske funn 
4. Arkivering av utdaterte MD-filer fullfÃ¸rt

ğŸ¯ SYSTEMET ER NÃ… PRODUKSJONSKLART MED EMPIRISK GRUNNLAG:
- Validert logikk: detect_precipitation_type() og is_slippery_road_risk()
- Streamlit-app: Viser nedbÃ¸rtype-klassifisering med 3-panel visualisering
- Empirisk kalibrert: Basert pÃ¥ 149 episoder med vind/snÃ¸-data
- GlattfÃ¸re-deteksjon: KUN regn trigger risiko (ikke vindblÃ¥st snÃ¸)
- 29 vindblÃ¥st snÃ¸-episoder identifisert og klassifisert korrekt

ğŸ“Š NEDBÃ˜RTYPE-KLASSIFISERING (EMPIRISK VALIDERT MED 149 EPISODER):
â€¢ REGN: Temp > 0Â°C + snÃ¸mengde minkende + vind < 8 m/s
â€¢ SNÃ˜: Temp < -2Â°C + snÃ¸mengde Ã¸kende + vind < 8 m/s  
â€¢ VINDBLÃ…ST SNÃ˜ (HÃ˜Y): Temp < 0Â°C + vind > 12 m/s + snÃ¸-reduksjon < -5 cm
â€¢ VINDBLÃ…ST SNÃ˜ (MEDIUM): Temp < 0Â°C + vind > 10 m/s + snÃ¸-reduksjon < -3 cm
â€¢ SNÃ˜ MED VINDPÃ…VIRKNING: Temp < 0Â°C + vind 6-10 m/s + liten snÃ¸-endring
â€¢ VÃ…T SNÃ˜: Temp rundt 0Â°C + snÃ¸mengde Ã¸kende + moderat vind

ğŸš¨ KRITISKE VINDTERSKLER (EMPIRISK BEVIST):
- Korrelasjon vind vs snÃ¸mengde-endring: -0.423 (kald), -0.411 (rundt frysing)
- Median vindterskel for snÃ¸mengde-reduksjon: 12.2 m/s
- 29 vindblÃ¥st snÃ¸-episoder over 149 testede (19.5%)
- VindblÃ¥st snÃ¸ gir ALDRI glattfÃ¸re-risiko (kritisk for falske alarmer)
- Kun regn ved lav temperatur gir glattfÃ¸re-risiko

ğŸ¨ STREAMLIT-APP FUNKSJONER (VALIDERT):
1. Kombinert risikograf (snÃ¸fokk + glattfÃ¸re + slush)
2. NedbÃ¸rtype-klassifisering (empirisk validert 12. aug 2025)
3. Robust fallback for manglende data
4. GlattfÃ¸re-risiko kun ved regn-klassifisering
5. Automatisk kolonne-deteksjon for ulike nedbÃ¸r-felt

ğŸ“ ARKIVERING FULLFÃ˜RT 12. AUGUST 2025:
- Utdaterte MD-filer flyttet til archive/outdated_md_files/
- README.md oppdatert med empiriske funn
- Kun relevante dokumentasjonsfiler beholdt i hovedmappen

# =============================================================================

# Kodestandard
code_style:
  - FÃ¸lg PEP 8 for Python-kode
  - Maksimal linjelengde er 79 tegn
  - Bruk norske variabelnavn og kommentarer
  - Dokumenter funksjoner med docstrings pÃ¥ norsk
  - Logg viktige hendelser med logging-modulen
  - Bruk f-strings for formatering
  - Bruk type hints for bedre lesbarhet
  - Del opp lange funksjoner i mindre, gjenbrukbare deler

# Filstruktur
project_structure:
  scripts:
    - Hovedscript i scripts/-mappen
    - Hjelpefunksjoner i scripts/utils/
    - Utdaterte script i scripts/arkivert/
  data:
    - RÃ¥data i data/raw/
    - Prosessert data i data/processed/
    - TemporÃ¦re filer i data/temp/
    - Kart og grafer i data/output/
  config:
    - Hovedkonfig i config/
    - Test-konfig i config/test/
  logs:
    - Separate loggfiler per script
    - Roter logger hver uke
    - Behold logger i 3 mÃ¥neder

# Sikkerhet
security:
  konfigurasjon:
    - Aldri hardkod passord eller API-nÃ¸kler
    - Bruk miljÃ¸variabler for ekstra sensitiv data
    - Krypter konfigurasjonsfiler i produksjon
  validering:
    - Valider all brukerinput
    - Sjekk filrettigheter fÃ¸r skriving
    - Sikre backup fÃ¸r kritiske operasjoner
  feilhÃ¥ndtering:
    - Logg alle feil med stack trace
    - Send varsler ved kritiske feil
    - Implementer retry-mekanismer for nettverkskall

# DatahÃ¥ndtering
data_handling:
  datoformat:
    - Lagre alle datoer i ISO-format med UTC
    - Vis datoer i norsk format (DD.MM.YYYY)
    - HÃ¥ndter sommertid korrekt
  kundedata:
    - Konverter kundeID til string ved sammenligning
    - Valider koordinater fÃ¸r bruk
    - Sjekk at alle pÃ¥krevde felt er tilstede
  backup:
    - Ta backup fÃ¸r stÃ¸rre dataendringer
    - Behold ukentlige backups i 3 mÃ¥neder
    - Automatisk backup ved kritiske operasjoner

# Kartgenerering
map_generation:
  kart:
    - Bruk Folium for interaktive kart
    - Sentrer kart pÃ¥ Fjellbergsskardet
    - Zoom-nivÃ¥ 16 som standard
    - Bruk CartoDB positron som basiskart
  markÃ¸rer:
    - BlÃ¥ markÃ¸r for Ã¥rsabonnement
    - RÃ¸d markÃ¸r for ukentlige bestillinger
    - Tydelige kundenummer som labels
    - Minimum 12px markÃ¸rstÃ¸rrelse for touch
  output:
    - Generer bÃ¥de HTML og PNG
    - PNG med minimum 1920x1080 opplÃ¸sning
    - Inkluder mobilvennlig tegnforklaring
    - Optimaliser for utskrift

# E-post
email:
  format:
    - HTML-formatert hovedinnhold
    - Inkluder ren tekst-versjon
    - Norsk formatering av datoer og tall
    - Konsistent font og stil
  vedlegg:
    - HTML-versjon av kart
    - PNG-versjon av kart
    - Maksimal vedleggstÃ¸rrelse 10MB
  innhold:
    - Tydelig statistikk fÃ¸rst
    - GruppÃ©r kunder etter rode
    - Marker ukentlige bestillinger med stjerne
    - Inkluder dato og tidspunkt for generering

# VÃ¦rdata
weather:
  api:
    - Bruk Frost API for vÃ¦rdata
    - Cache vÃ¦rdata i 15 minutter
    - Implementer rate limiting
    - HÃ¥ndter API-feil grasiÃ¸st
  nedbÃ¸rtype_deteksjon:
    - EMPIRISK VALIDERT med 149 episoder: vind er kritisk faktor!
    - REGN = temp > 0Â°C + nedbÃ¸r + snÃ¸mengde MINKENDE + vind < 8 m/s
    - SNÃ˜ = temp < 0Â°C + nedbÃ¸r + snÃ¸mengde Ã˜KENDE
    - VINDBLÃ…ST SNÃ˜ = temp < 0Â°C + vind > 10 m/s + snÃ¸mengde MINKENDE
    - Median vindterskel for snÃ¸mengde-reduksjon: 12.2 m/s
    - Korrelasjon vind vs snÃ¸mengde-endring: -0.423 (kald), -0.411 (rundt frysing)
    - VED GRENSEOMRÃ…DET (-1Â°C til +1Â°C): Krever analyse av temperatur, snÃ¸-endring OG vind
    - 29 vindblÃ¥st snÃ¸-episoder identifisert (IKKE regn!)
  glattfÃ¸re_kriterier:
    - GLATTFÃ˜RE varsles kun ved REGN (ikke snÃ¸/sludd/vindblÃ¥st snÃ¸)
    - VINDBLÃ…ST SNÃ˜ = INGEN GLATTFÃ˜RE (kritisk for falske alarmer)
    - HÃ¸y risiko: temp > 0Â°C + nedbÃ¸r + snÃ¸mengde MINKENDE + vind < 8 m/s
    - Medium risiko: temp rundt 0Â°C + regn (ikke vindblÃ¥st snÃ¸)
    - ALDRI varsle glattfÃ¸re ved vindblÃ¥st snÃ¸ (vind > 10 m/s + snÃ¸-reduksjon)
    - GrenseomrÃ¥de: -1Â°C til +1Â°C krever detaljert vind-analyse
  varsler:
    - Varsle ved > 10cm nysnÃ¸
    - Varsle ved snÃ¸fokk (vind > 6 m/s og temp < -1Â°C)
    - Varsle ved glattfÃ¸re (regn ved temp > -2Â°C)
    - Varsle ved ekstremvÃ¦r
    - Send SMS ved kritiske varsler

# Testing
testing:
  enhetstester:
    - Test alle kritiske funksjoner
    - Mock eksterne API-kall
    - Test med realistiske testdata
  integrasjonstester:
    - Test hele brÃ¸yteplanleggingen
    - Valider kartgenerering
    - Test e-postutsending
  logging:
    - Logg alle testresultater
    - Separate logger for tester
    - Behold testlogger i 1 mÃ¥ned

# Vedlikehold
maintenance:
  kode:
    - Dokumenter alle stÃ¸rre endringer
    - Hold dependencies oppdatert
    - Fjern utdatert kode
    - Optimaliser ytelse der mulig
  data:
    - Rydd i gamle kartfiler ukentlig
    - Arkiver gamle brÃ¸yteplaner mÃ¥nedlig
    - Valider databaseintegritet ukentlig
  overvÃ¥king:
    - OvervÃ¥k diskplass
    - Sjekk API-tilgjengelighet
    - Monitor systemressurser
    - Varsle ved unormale mÃ¸nstre 